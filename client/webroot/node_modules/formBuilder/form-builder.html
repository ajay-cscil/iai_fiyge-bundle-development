<!DOCTYPE html>
<html>
	<head>
	                <script src="/node_modules/jquery/dist/jquery.min.js"></script>
	                <script src="/node_modules/jquery-ui-sortable/jquery-ui.min.js"></script>
	                <script src="/node_modules/formBuilder/dist/form-builder.min.js"></script>
	                <script src="/node_modules/formBuilder/dist/form-render.min.js"></script>
					<link rel="stylesheet" href="/node_modules/formBuilder/dist/bootstrap.min.css">
					<link rel="stylesheet" href="/node_modules/formBuilder/form-builder.css?3">

	</head>
<body>
<div id="fb-editor"></div>
<script>
	var formBuilder = null;
	var fbEditor = null;
	jQuery(function($) {
		window.parent.postMessage("init","*");
    });
    var displayMessage=function(event) {
    		options=JSON.parse(event.data);
    		if(options.mode=="render"){
    			formBuilder = jQuery('#fb-editor').formRender({
							    "dataType": "json",
							    "formData": options.formData
							  });
    		}else{
	    		if(options.formData){
			    	let fields = [];
					let templates = {
					 
					};
					var defaultFields=[];
					if(options.formData){
							defaultFields=options.formData;
					}
					for(var i=0; i < options.modelFields.length; i++){
								var field = {};
								switch(options.modelFields[i]['type']){
									case "popup":
									case 'select':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'select',
										    class: 'form-control'
										}
									}
									if(options.modelFields[i].values){
										field["values"]=options.modelFields[i].values;
									}
									break;
									case "button":
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'button',
										    class: 'form-control'
										}
									}
									break;
									case "checkbox":
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'checkbox-group',
										    class: 'form-control'
										}
									}
									if(options.modelFields[i].values){
										field["values"]=options.modelFields[i].values;
									}
									break;
									case 'radio':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'radio-group',
										    class: 'form-control'
										}
									}
									if(options.modelFields[i].values){
										field["values"]=options.modelFields[i].values;
									}
									break;
									case "date":
									case "datetime":
									case "time":
										var field = {
											  label: options.modelFields[i].label,
											  name: options.modelFields[i].name,
											  attrs: {
											    type: 'date',
											    class: 'form-control'
											  }
											};
									break;
									case "fileupload":
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'file',
										    class: 'form-control'
										}
									}
									break;
									case 'header':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'header',
										    class: 'form-control'
										}
									}
									break;
									case 'hidden':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'hidden',
										    class: 'form-control'
										}
									}
									break;
									case 'number':
									case "int":
									case "float":
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'number',
										    class: 'form-control'
										}
									}
									break;
									case 'paragraph':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'paragraph',
										    class: 'form-control'
										}
									}
									break;
									case 'text':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  maxlength:parseInt(options.modelFields[i].length?options.modelFields[i].length:255),
										  attrs: {
										    type: 'text',
										    class: 'form-control'
										}
									}
									break;
									case 'textarea':
									field = {
										  label: options.modelFields[i].label,
										  name: options.modelFields[i].name,
										  attrs: {
										    type: 'textarea',
										    class: 'form-control'
										}
									}
									break;
									case "string":
										if(options.modelFields[i].length > 255){
											field = {
												  label: options.modelFields[i].label,
												  name: options.modelFields[i].name,
												  maxlength:parseInt(options.modelFields[i].length?options.modelFields[i].length:255),
												  attrs: {
												    type: 'textarea',
												    class: 'form-control'
												  }
											};
										}else{
											field = {
												  label: options.modelFields[i].label,
												  name: options.modelFields[i].name,
												  attrs: {
												    type: "text",
												    class: 'form-control'
												  }
											};
										}
									break;
									default:
										field = {
											  label: options.modelFields[i].label,
											  name: options.modelFields[i].name,
											  maxlength:parseInt(options.modelFields[i].length?options.modelFields[i].length:255),
											  attrs: {
											    type: 'text',
											    class: 'form-control'
											  }
										};
								}
								
						fields.push(field);    				 				       	
				    }
				    
					if(fields.length > 0){
						//fields=fields.reverse();
					}
			    	var formBuilderOptions={
			    		"sortableControls":false,
			    		disabledActionButtons: ['data',"clear","save"],
			    		"defaultFields":(options.formData?options.formData:[]),
			    		"disableFields": ['file'],
			    		"fields":fields,
			    		"controlOrder":[	'button',
											'text',
											'number',
											'date',
											'select',
											'textarea',	
											'hidden',
											'autocomplete',
											'checkbox-group',
											'file',
											'radio-group',
											'header',
											'paragraph'
											
										],
			    		"onSave":function(evt, formData) {
			    			window.parent.postMessage(JSON.stringify(formData),"*");
				        }
			    	};
			    	formBuilder = jQuery('#fb-editor').formBuilder(formBuilderOptions);
			    	/*
			    	setTimeout(function(){
						console.log(jQuery('li[data-type="paragraph"]').length);
						jQuery('li[data-type="paragraph"]')
						.after('<li class="field-heading"><span>Fields</span></li>');
						jQuery(".field-heading").draggable('disable');
					},1000);
					*/

			    	


			    	setInterval(function(){
			    		window.parent.postMessage(JSON.stringify(formBuilder.actions.getData()),"*");
			    	},500);	
			    }
	    	}	    	
	};
    window.addEventListener("message", displayMessage, false);

</script>
</body>
</html>