[
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "56",
        "created": "2013-12-07 21:41:44",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a39618-9538-4379-aa02-02280a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": null,
        "modified_by": null,
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Set Flag Waiting For Delivery",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "58",
        "created": "2013-12-07 21:42:49",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a39659-4358-4c7d-a9e6-027c0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": null,
        "modified_by": null,
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Overdue",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "59",
        "created": "2013-12-07 21:44:53",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a396d5-8cb8-4fe6-bb1e-027e0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-03-25 20:00:05",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Delivery Order 'Check Availability'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$data = $object->data['entity'];\r\n$to_id=$data['transfer_orders_id'];\r\nif (array_key_exists(\"delivery_order_lines\", $data)) {\r\n    foreach ($data['delivery_order_lines'] as $line) {\r\n        if (!$line['deleted']) {\r\n            $product = current(\\module\\product\\model\\products::getInstance()->read($line['product_id']));\r\n\r\n            $qty = isset($product['quantity_on_hand']) ? $product['quantity_on_hand'] : 0.0;\r\n\r\n\r\n            if ($line['quantity'] > $qty) {\r\n\r\n                if (isset($to_id) && !empty($to_id)) {\r\n                    $src_location = \\select('location_source.name')->from('\\\\module\\\\stock\\\\model\\\\stock_moves')->join('location_source')\r\n                    ->where(array('related_to' => $data['transfer_orders_id'], 'related_to_model' => 'transfer_orders', 'product_id' => $line['product_id']))\r\n                    ->limit(0)->inserted()->execute()->fetchAll(\\PDO::FETCH_ASSOC);\r\n                    \r\n                    throw new \\Exception(sprintf(__(\"Available quantity for product \\\"%s\\\"is low. Please do inventory update on location \\\"%s\\\" for this product\",\"module\"), $product['name'],$src_location[0]['name']));\r\n                                                       }\r\nelse {\r\n               throw new \\Exception(sprintf(__(\"Available quantity for product \\\"%s\\\"is low. Please do inventory update\", \"module\"), $product['name']));\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n    $object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "60",
        "created": "2013-12-07 21:45:43",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a39707-9f8c-4e8d-990c-027e0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-02-11 21:46:46",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Force Availability'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "61",
        "created": "2013-12-07 21:52:37",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a398a5-4e94-4049-8964-027d0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2013-12-07 21:53:00",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Deliver'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "63",
        "created": "2013-12-07 21:54:38",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a3991e-91b4-48df-9d8a-027c0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-04-04 00:09:52",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Pack'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$dataDO = $object->data['entity'];\r\nif (is_array($dataDO)) {\r\n    if (!isset($dataDO['transfer_orders_id']) || empty($dataDO['transfer_orders_id']) || is_null($dataDO['transfer_orders_id'])){\r\n        $smObject = \\module\\stock\\model\\stock_moves::getInstance();\r\n        if (isset($dataDO['delivery_order_lines']) && is_array($dataDO['delivery_order_lines'])) {\r\n            foreach ($dataDO['delivery_order_lines'] as $line) {\r\n                if (!($line['deleted'] == 1)) {\r\n                    $smData = array();\r\n                    $loc = array();\r\n                    \r\n\t                if (!isset($dataDO['sales_shop_id']) && is_null($dataDO['sales_shop_id'])){\r\n\t                \tthrow new \\Exception(sprintf(__(\"Please assign Sale Shop to Delivery Order \\\"%s\\\".\",\"module\"), $dataDO['name']));\r\n\t                }\r\n\t                $warehouse = \\select(array('warehouse_id'))->from('\\\\module\\\\sales\\\\model\\\\sale_shop')->where('id',$dataDO['sales_shop_id'])->execute()->fetch(\\PDO::FETCH_COLUMN);\r\n\t                if (!isset($warehouse) || !$warehouse || is_null($warehouse) || empty($warehouse)){\r\n\t                \tthrow new \\Exception(sprintf(__(\"Please assign Warehouse to Sales Shop - \\\"%s\\\".\",\"module\"), $dataDO['__sales_shop_id']));\r\n\t                }\r\n                    if (!is_empty($line['product_id']) && isset($line['product_id'])) {\r\n\t                $def_loc = \\select(array('location_id'))->from('\\\\module\\\\product\\\\model\\\\warehouse_locations')\r\n\t                \t\t\t->where(array('warehouse_id' => $warehouse,\r\n\t                                \t\t  'product_id' => $line['product_id']))->execute()->fetch(\\PDO::FETCH_COLUMN);\r\n\r\n\t                if (!isset($def_loc) || !$def_loc || is_null($def_loc) || empty($def_loc)){\r\n\t                \tthrow new \\Exception(sprintf(__(\"Please assign default location for Product - \\\"%s\\\".\",\"module\"), $line['__product_id']));\r\n\t                }\r\n\t                $smData['quantity'] = $line['quantity'];\r\n\t                $smData['source_location_id'] = $def_loc;\r\n\t                $smData['destination_location_id'] = 4;\r\n\t                $smData['description'] = $line['__product_id'];\r\n\t                $smData['type'] = 'Sending Goods';\r\n\t                $smData['status'] = 'Available';\r\n\t                $smData['product_id'] = $line['product_id'];\r\n\t                $smData['uom_id'] = $line['uom_id'];\r\n\t                $smData['memo'] = $dataDO['number'];\r\n\t                $smData['related_to'] = $dataDO['id'];\r\n                        $smData['__related_to'] = $dataDO['number'];\r\n                        $smData['related_to_model'] = 'delivery_orders';\r\n\t                $smData['fulfillment_date'] = date('Y-m-d H:i:s');\r\n\t                $smObject->save($smData, array('atomic' => true, 'validate' => FALSE));\r\n\t                }\r\n\t            }\r\n\t        }\r\n\t    }\r\n\t}\r\n    $object->exitNode();\r\n}"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "3",
        "created": "2013-12-09 15:03:45",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a5dbd1-b8fc-4d95-879a-6e1e0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2013-12-09 21:42:06",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Approve'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": " $object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "44",
        "created": "2013-12-09 17:43:34",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a60146-ad1c-4628-9fbc-7c670a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-02-10 19:38:07",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Dispatch'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$dataDO = $object->data['entity'];\r\nif (is_array($dataDO)) {\r\n    $smObject = \\module\\stock\\model\\stock_moves::getInstance();\r\n    if (isset($dataDO['delivery_order_lines']) && is_array($dataDO['delivery_order_lines'])) {\r\n        foreach ($dataDO['delivery_order_lines'] as $line) {\r\n            if (!($line['deleted'] == 1)) {\r\n                $smData = array();\r\n                $loc = array();\r\n                if (!isset($dataDO['sales_shop_id']) && is_null($dataDO['sales_shop_id'])){\r\n                \tthrow new \\Exception(sprintf(__(\"Please assign Sale Shop to Delivery Order \\\"%s\\\".\",\"module\"), $dataDO['name']));\r\n                }\r\n                $warehouse = \\select(array('warehouse_id'))->from('\\\\module\\\\sales\\\\model\\\\sale_shop')->where('id',$dataDO['sales_shop_id'])->execute()->fetch(\\PDO::FETCH_COLUMN);\r\n                if (!isset($warehouse) || !$warehouse || is_null($warehouse) || empty($warehouse)){\r\n                \tthrow new \\Exception(sprintf(__(\"Please assign Warehouse to Sales Shop - \\\"%s\\\".\",\"module\"), $dataDO['name']));\r\n                }\r\n                $def_loc = \\select(array('location_id'))->from('\\\\module\\\\product\\\\model\\\\warehouse_locations')\r\n                \t\t\t->where(array('warehouse_id' => $warehouse,\r\n                                \t\t  'product_id' => $line['product_id']))->execute()->fetch(\\PDO::FETCH_COLUMN);\r\n\r\n                if (!isset($def_loc) || !$def_loc || is_null($def_loc) || empty($def_loc)){\r\n                \tthrow new \\Exception(sprintf(__(\"Please assign default location for Product - \\\"%s\\\".\",\"module\"), $line['__product_id']));\r\n                }\r\n                \r\n                $smData['quantity'] = $line['quantity'];\r\n                $smData['source_location_id'] = $def_loc;\r\n                $smData['destination_location_id'] = 4;\r\n                $smData['description'] = $line['__product_id'];\r\n                $smData['type'] = 'Sending Goods';\r\n                $smData['status'] = 'Done';\r\n                $smData['product_id'] = $line['product_id'];\r\n                $smData['uom_id'] = $line['uom_id'];\r\n                $smData['memo'] = 'DO#'.$dataDO['id'];\r\n                $smData['fulfillment_date'] = microtime(true);\r\n                $smObject->save($smData, array('atomic' => true, 'validate' => FALSE));\r\n\r\n            }\r\n        }\r\n    }\r\n    $object->exitNode();\r\n}\r\n"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "76",
        "created": "2013-12-09 22:15:54",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52a6411a-bccc-4e36-82ba-14e70a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2013-12-18 22:46:32",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Release Order'",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": " $object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "65",
        "created": "2013-12-23 17:18:50",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52b8707a-4c98-49e7-9202-5b7a0a550b97",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": null,
        "modified_by": null,
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Action 'Return Shipment\"",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "92",
        "created": "2014-02-11 21:49:18",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52fa9ade-3450-4ea2-bce5-0f16ac100612",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-02-11 22:21:01",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Received",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$object->exitNode();"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "80",
        "created": "2014-02-12 13:23:01",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52fb75b5-1e8c-42e2-933e-1175ac100612",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-03-20 18:26:43",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Generate Shipment",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$dataDO = $object->data['entity'];\r\nif (is_array($dataDO)) {\r\n    if (!isset($dataDO['transfer_orders_id']) || empty($dataDO['transfer_orders_id']) || is_null($dataDO['transfer_orders_id'])){\r\n        \\update(array('status'=>'Done'))->from('\\\\module\\\\stock\\\\model\\\\stock_moves')\r\n                    \t\t->where(array('related_to' => $dataDO['id']))->where(array('related_to_model' => 'delivery_orders'))->execute();\r\n\t}\r\n    $object->exitNode();\r\n}"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": null,
        "created": "2014-03-20 18:45:34",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": "beforeSave",
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "532b374e-0630-41a1-9bf8-28a1ac1006a4",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-03-20 18:46:44",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Expected Date Delivery Order",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$Validtill=$object->data;\r\n\r\n\r\nif ((isset($Validtill['effective_from']) && isset($Validtill['effective_to']) || (!empty($Validtill['effective_from']) && !empty($Validtill['effective_to']))) && $Validtill['effective_from']>$Validtill['effective_to']) {\r\nthrow new \\Exception('Expected Delivery date should be greater than Order Date');\r\n}\r\n\r\n"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": "91",
        "created": "2014-02-11 21:26:29",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": null,
        "filter_path": "\/module\/stock\/model\/delivery_orders",
        "id": "52fa9585-cf8c-41ae-9759-0c77ac100612",
        "if_condition": "1",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": "119",
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-02-11 22:28:54",
        "modified_by": "1",
        "module_id": "27263d19-e746-11e3-aad5-0800275f9930",
        "name": "Confirm",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "2",
        "rgt": "120",
        "run_once": null,
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "if (!$object->isLogSet()) {\r\n\t$object->setWorkflowLog(array(array('can_edit' => 1, 'foreign_key' => \\tushar\\user::read('id'), 'foreign_key_model' => 'users')));\r\n}\r\n$node = $object->node($object->nodeID());\r\nif ($node['status'] == 'open') {\r\n    $object->logAction($node['id']);\r\n    $nextStages=$object->nextMoveToStages($node['id']);\r\n\t$nextStageList=array();\r\n\t$doData = $object->data['entity'];\r\n\tforeach ($nextStages as $id=>$stage) {\r\n\t    $nextStages[$id]['parent_id']=$node['id'];  \r\n\t    $flag = true;\r\n\t\tif(array_key_exists(\"delivery_order_lines\", $doData)) {\r\n\t\t    foreach($doData['delivery_order_lines'] as $line){\r\n\t\t        if (!$line['deleted']){\r\n\t\t            $product = current(\\module\\product\\model\\products::getInstance()->read($line['product_id']));\r\n\t\t            \/\/ v1 to check qty in all warehouses total\r\n\t\t            \/\/ @todo : check in same warehouse only\r\n\t\t            $qty = isset($product['quantity'])?$product['quantity']:0.0;\r\n\t\t            if ($line['quantity'] > $qty){\r\n\t\t    \t\t\t$flag = FALSE;\r\n\t\t    \t\t\tbreak;\r\n\t\t        \t}\r\n\t\t        }\t\r\n\t\t    }    \r\n\t\t}\r\n\t    if($flag){\r\n\t        if(strcasecmp($stage['name'], 'Waiting for Availability') == 0 ){\r\n\t            $nextStages[$id]['status']='canceled';\r\n\t            $nextStages[$id]['message'] = 'canceled';\r\n\t            $nextStageList[$id]=$nextStages[$id];\r\n\t    \t}\r\n\t    }elseif (strcasecmp($stage['name'],'Available') == 0 ) {\r\n             $nextStages[$id]['status']='canceled';\r\n             $nextStages[$id]['message'] = 'canceled';\r\n             $nextStageList[$id]=$nextStages[$id];\r\n    }       \r\n}\r\n$nextStageList=array_merge($nextStageList,array_diff_key($nextStages,$nextStageList));\r\n$nextNodes=$object->logNextMoveToStages($nextStageList);\r\n$object->exitNode(null,$nextNodes);\r\n}"
    }
]