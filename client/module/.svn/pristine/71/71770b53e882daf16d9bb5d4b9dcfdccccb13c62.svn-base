[
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": null,
        "created": "2013-12-10 18:09:12",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": "afterSave",
        "filter_path": "\/module\/email_intelligence\/model\/message_log",
        "id": "52a758c8-6c78-4fdb-8706-145a0a550b97",
        "if_condition": "stripos($object->data['subject'],'Repository updated') !== false",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": null,
        "modified_by": null,
        "module_id": "27263f86-e746-11e3-aad5-0800275f9930",
        "name": "Create Leads From email",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": "1",
        "runlevel": "2",
        "stage_id": null,
        "then_condition": "$name=explode('@',$object->data['from']);\r\n$leadObject=\\module\\crm\\model\\leads::getInstance()\r\n->save(\r\narray(\r\n'personal_email'=>$object->data['from'],\r\n'office_email'=>$object->data['from'],\r\n'office_phone'=>'99999999999',\r\n'company'=>$name[1],\r\n'first_name'=>$name[0],\r\n'last_name'=>$name[1],\r\n'description'=>$object->data['content']\r\n),array('atomic'=>true,'validate'=>false));\r\n"
    },
    {
        "_acl": null,
        "_acl_delete": null,
        "_acl_edit": null,
        "_acl_tmp": null,
        "_acl_tmp_delete": null,
        "_acl_tmp_edit": null,
        "action_id": null,
        "created": "2014-07-29 21:22:22",
        "created_by": "-1",
        "data_conflict": null,
        "deleted": "0",
        "description": null,
        "else_condition": null,
        "event": "afterSave",
        "filter_path": "\/module\/email_intelligence\/model\/message_log",
        "id": "53d8108e-d2c4-47df-addd-538f0af91b9d",
        "if_condition": "isset($object->data['from']) && !empty($object->data['from'])",
        "is_commit_pending": "0",
        "is_demo_data": "0",
        "is_public": "1",
        "is_terminal": null,
        "lft": null,
        "md5": null,
        "message_error": null,
        "message_info": null,
        "message_warn": null,
        "modified": "2014-08-01 12:53:50",
        "modified_by": "1",
        "module_id": "27263f86-e746-11e3-aad5-0800275f9930",
        "name": "Process Incoming emails",
        "old_parent_id": null,
        "owned_by": "-2",
        "parent_id": null,
        "record_flags": null,
        "revision": "1",
        "rgt": null,
        "run_once": null,
        "runlevel": "5",
        "stage_id": null,
        "then_condition": "$from=explode(\"<\",$object->data['from']);\r\n$from=isset($from[1])?$from[1]:$from[0];\r\n$from=explode(\">\",$from);\r\n$from=$from[0];\r\n\r\n\/\/ $object is message log.\r\n\r\n$related=\\select(array(\"__related_to\",\"related_to\",\"related_to_model\"))\r\n->from(\\module\\crm_base\\model\\email_addresses::getInstance(array(),true))\r\n->inserted()->where('email',$from)->limit(1)->execute()->fetch(\\PDO::FETCH_ASSOC);\r\nif(empty($related)){\r\n   $related=\\select(array(\"name as '__related_to'\",\"id as 'related_to'\",\"'leads' as related_to_model\"))\r\n    ->from(\\module\\crm\\model\\leads::getInstance(array(),true))\r\n    ->inserted()->where(array('OR'=>array('office_email'=>$from,'personal_email'=>$from)))\r\n    ->limit(1)->execute()->fetch(\\PDO::FETCH_ASSOC);\r\n}\r\n\r\nif(!empty($related)){\r\n    $data=array();\r\n    $data['__related_to']=$related['__related_to'];\r\n    $data['related_to']=$related['related_to'];\r\n    $data['related_to_model']=$related['related_to_model'];\r\n    $data['created']=date('Y-m-d h:i:s',strtotime($object->data['date']));\r\n    $data['subject']=$object->data['subject'];\r\n    $data['body']=$object->data['text_html'];\r\n    $data['email_to_recipients']=$object->data['to']; \r\n\t$data['email_cc_recipients']=str_replace(\";\",\",\",$object->data['cc']); \r\n\t$data['email_bcc_recipients']=str_replace(\";\",\",\",$object->data['bcc']);\r\n\t$data['status']='received';\r\n    \\module\\activities\\model\\emails::getInstance()\r\n    ->save($data,array('atomic'=>true,'validate'=>false));\r\n} \r\n"
    }
]